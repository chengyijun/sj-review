<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>轮播图</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        #box {
            width: 900px;
            height: 400px;
            background-color: cyan;
            margin: 50px auto;
            position: relative;
            overflow: hidden;
        }

        #viewer {
            width: 900px;
            height: 400px;
            background-color: lightblue;


        }

        #slider {
            width: 6300px;
            height: 400px;
            position: absolute;
            top: 0;
            left: -900px;

        }

        .slice:nth-child(1) {
            background-color: blue;
        }

        .slice:nth-child(2) {
            background-color: red;
        }

        .slice:nth-child(3) {
            background-color: orange;
        }

        .slice:nth-child(4) {
            background-color: purple;
        }

        .slice:nth-child(5) {
            background-color: green;
        }

        .slice:nth-child(6) {
            background-color: blue;
        }

        .slice:nth-child(7) {
            background-color: red;
        }

        .slice {
            width: 900px;
            height: 400px;
            color: white;
            font-size: 50px;
            float: left;

        }

        #pointer {
            z-index: 100;
            font-size: 20px;
            /*background-color: cyan;*/
            position: absolute;
            bottom: 50px;
            right: 50px;
            display: inline;
        }

        .po {
            background-color: rgba(255, 255, 255, .7);
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
            border-radius: 100%;
            float: left;
            list-style: none;
            margin-right: 10px;
        }

        .po.active {
            background-color: rgba(0, 0, 0, .7);
            color: white;
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
            border-radius: 100%;
            float: left;
            list-style: none;
            margin-right: 10px;
        }

        .btn {
            z-index: 100;
            position: absolute;
            bottom: 150px;
            width: 50px;
            height: 100px;
            font-size: 30px;
            color: white;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .btn:hover {
            z-index: 100;
            position: absolute;
            bottom: 150px;
            width: 50px;
            height: 100px;
            font-size: 30px;
            color: black;
            background-color: rgba(255, 0, 0, 0.4);
        }

        .left {
            left: 0;
        }

        .right {
            right: 0;
        }


    </style>
</head>
<body>
<div id="box">
    <div id="viewer">
        <div id="slider">
            <div class="slice">5</div>
            <div class="slice">1</div>
            <div class="slice">2</div>
            <div class="slice">3</div>
            <div class="slice">4</div>
            <div class="slice">5</div>
            <div class="slice">1</div>
        </div>
    </div>

    <ul id="pointer">
        <li class="po active">1</li>
        <li class="po">2</li>
        <li class="po">3</li>
        <li class="po">4</li>
        <li class="po">5</li>
    </ul>

    <button id="btnleft" class="btn left"><</button>
    <button id="btnright" class="btn right">></button>
</div>

<script>

    class Swiper {
        constructor() {
            this.btnleft = document.getElementById('btnleft')
            this.btnright = document.getElementById('btnright')
            this.slider = document.getElementById('slider')
            this.currentIndex = 1
            // 自动播放定时器
            this.autoPlayTimer = null
            this.pointers = document.getElementById('pointer').children
            // 监听
            this.btnleft.addEventListener('click', () => {
                clearInterval(this.autoPlayTimer)
                this.goLeft()
                this.autoPlay()
            })
            this.btnright.addEventListener('click', () => {
                clearInterval(this.autoPlayTimer)
                this.goRight()
                this.autoPlay()
            })
        }

        goRight() {
            let steps = this.getSteps(0, 900)


            const t1 = setInterval(() => {
                let now = parseInt(window.getComputedStyle(this.slider, null).left)
                // 移动
                if (steps.length > 0) {
                    this.slider.style.left = now - steps.pop() + 'px'
                } else {
                    // 完成了移动
                    // 清除定时器
                    clearInterval(t1)
                    // 将当前显示的滑片索引+1
                    this.currentIndex++

                }
            }, 30)

            // 防止越界
            if (this.currentIndex === 6) {
                this.slider.style.left = -900 + 'px'
                this.currentIndex = 1
                // 为小圆点设置活动
                for (let pointer of this.pointers) {
                    pointer.classList.remove('active')
                }
                this.pointers[this.currentIndex - 1].classList.add('active')
            }

            // 为小圆点设置活动
            for (let pointer of this.pointers) {
                pointer.classList.remove('active')
            }
            if (this.currentIndex <= 4)
                this.pointers[this.currentIndex].classList.add('active')

        }

        goLeft() {
            let steps = this.getSteps(0, 900)


            const t1 = setInterval(() => {
                let now = parseInt(window.getComputedStyle(this.slider, null).left)
                // 移动
                if (steps.length > 0) {
                    this.slider.style.left = now + steps.pop() + 'px'
                } else {
                    // 完成了移动
                    // 清除定时器
                    clearInterval(t1)
                    // 将当前显示的滑片索引-1
                    this.currentIndex--
                }
            }, 30)

            if (this.currentIndex === 0) {
                this.slider.style.left = -4500 + 'px'
                this.currentIndex = 5
            }
        }

        /**
         * 自动播放
         */
        autoPlay() {
            this.autoPlayTimer = setInterval(() => {
                this.goRight()
            }, 3000)
        }

        sortNumber(a, b) {
            return a - b
        }

        /**
         * 获取给定范围的等差数列作为移动的步长
         */
        getSteps(start, end) {
            let range = end - start
            let total = 0
            let step = 1
            let arrs = []
            while (total < range) {
                step++
                total += step
                arrs.push(step)
            }

            let tmp = 0
            tmp = total - range
            if (tmp > 0) {
                let last = arrs.pop()
                arrs.push(last - tmp)
            }
            arrs.sort(this.sortNumber)
            return arrs
        }


    }


    const swiper = new Swiper()
    swiper.autoPlay()
</script>
</body>
</html>