<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>轮播图</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        #box {
            width: 900px;
            height: 400px;
            background-color: cyan;
            margin: 50px auto;
            position: relative;
            overflow: hidden;
        }

        #viewer {
            width: 900px;
            height: 400px;
            background-color: lightblue;


        }

        #slider {
            width: 6300px;
            height: 400px;
            position: absolute;
            top: 0;
            left: -900px;

        }

        .slice:nth-child(1) {
            background-color: lightcoral;
        }

        .slice:nth-child(2) {
            background-color: lightsalmon;
        }

        .slice:nth-child(3) {
            background-color: lightcyan;
        }

        .slice:nth-child(4) {
            background-color: lightgoldenrodyellow;
        }

        .slice:nth-child(5) {
            background-color: lightgray;
        }

        .slice:nth-child(6) {
            background-color: lightgreen;
        }

        .slice:nth-child(7) {
            background-color: lightpink;
        }

        .slice {
            width: 900px;
            height: 400px;
            color: white;
            font-size: 50px;
            float: left;

        }

        #pointer {
            z-index: 100;
            font-size: 20px;
            /*background-color: cyan;*/
            position: absolute;
            bottom: 50px;
            right: 50px;
            display: inline;
        }

        .po {
            background-color: rgba(255, 255, 255, .7);
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
            border-radius: 100%;
            float: left;
            list-style: none;
            margin-right: 10px;
        }

        .po.active {
            background-color: rgba(0, 0, 0, .7);
            color: white;
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
            border-radius: 100%;
            float: left;
            list-style: none;
            margin-right: 10px;
        }

        .btn {
            z-index: 100;
            position: absolute;
            bottom: 150px;
            width: 50px;
            height: 100px;
            font-size: 30px;
            color: white;
            background-color: rgba(0, 0, 0, 0.4);
            border: 0;
        }

        .btn:hover {
            z-index: 100;
            position: absolute;
            bottom: 150px;
            width: 50px;
            height: 100px;
            font-size: 30px;
            color: black;
            background-color: rgba(255, 0, 0, 0.4);
        }

        .left {
            left: 0;
        }

        .right {
            right: 0;
        }


    </style>
    <script src="utils.js"></script>
</head>
<body>
<div id="box">
    <div id="viewer">
        <div id="slider">
            <div class="slice">1</div>
            <div class="slice">2</div>
            <div class="slice">3</div>
            <div class="slice">4</div>
            <div class="slice">5</div>
        </div>
    </div>

    <ul id="pointer">
        <li class="po active">1</li>
        <li class="po">2</li>
        <li class="po">3</li>
        <li class="po">4</li>
        <li class="po">5</li>
    </ul>

    <button id="btnleft" class="btn left"><</button>
    <button id="btnright" class="btn right">></button>
</div>

<script>

    class Swiper {
        constructor() {
            // 获取dom
            this.btnleft = document.getElementById('btnleft')
            this.btnright = document.getElementById('btnright')
            this.slider = document.getElementById('slider')
            this.slices = this.slider.children

            // 为了无缝衔接进行轮播 需要将头滑片复制一个加到尾部  将尾部滑片复制一个添加到头部
            this.firstNode = this.slices[this.slices.length - 1].cloneNode(true)
            this.lastNode = this.slices[0].cloneNode(true)
            this.slider.appendChild(this.lastNode)
            this.slider.insertBefore(this.firstNode, this.slices[0])

            // 初始轮播位置
            this.currentIndex = 0
            // 自动播放定时器
            this.autoPlayTimer = null
            this.leftPlayTImer = null
            this.rightPlayTimer = null
            this.pointers = document.getElementById('pointer').children

            // 是否可以点击按钮标志
            this.isLeftBtnClick = true
            this.isRightBtnClick = true

            // 监听左右按钮点击事件
            this.btnleft.addEventListener('click', () => {
                if (!this.isLeftBtnClick)
                    return
                clearInterval(this.autoPlayTimer)
                this.goLeft()
                this.autoPlay()
            })
            this.btnright.addEventListener('click', () => {
                if (!this.isRightBtnClick)
                    return
                clearInterval(this.autoPlayTimer)
                this.goRight()
                this.autoPlay()
            })
        }

        goRight() {
            this.isLeftBtnClick = false
            this.isRightBtnClick = false

            animation(this.slider, {left: -900 * (this.currentIndex + 2)}, (res) => {
                console.log(res);
                // 将当前显示的滑片索引+1
                this.currentIndex++
                // 移动完成 按钮改为可以点击状态
                this.isLeftBtnClick = true
                this.isRightBtnClick = true

                // 防止越界
                if (this.currentIndex === 5) {
                    this.slider.style.left = -900 + 'px'
                    this.currentIndex = 0
                }
            })

            // 为小圆点设置活动样式
            for (let pointer of this.pointers) {
                pointer.classList.remove('active')
            }
            if (this.currentIndex < 4)
                this.pointers[this.currentIndex + 1].classList.add('active')
            else
                this.pointers[0].classList.add('active')
        }

        goLeft() {

            this.isLeftBtnClick = false
            this.isRightBtnClick = false

            animation(this.slider, {left: -900 * (this.currentIndex)}, (res) => {
                console.log(res);
                // 将当前显示的滑片索引+1
                this.currentIndex--
                // 移动完成 按钮改为可以点击状态
                this.isLeftBtnClick = true
                this.isRightBtnClick = true
                // 防止越界
                if (this.currentIndex === -1) {
                    this.slider.style.left = -4500 + 'px'
                    this.currentIndex = 4
                }
            })

            // 为小圆点设置活动样式
            for (let pointer of this.pointers) {
                pointer.classList.remove('active')
            }
            if (this.currentIndex > 0) {
                this.pointers[this.currentIndex - 1].classList.add('active')
            } else
                this.pointers[4].classList.add('active')
        }

        /**
         * 自动播放
         */
        autoPlay() {
            this.autoPlayTimer = setInterval(() => {
                this.goRight()
            }, 3000)
        }
    }


    const swiper = new Swiper()
    swiper.autoPlay()
</script>
</body>
</html>